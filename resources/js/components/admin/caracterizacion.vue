<template>
    <div class="content">
	    <div class="container-fluid">
			<div class="row" id="admin">
			 <div class="col-md-12">
				<div class="card card-default">
	                <div class="card-header text-center" style="background-color: #2FA3C6; color: white;">
	                    <h4 class="title">CARACTERIZACIÓN - PLAN ANUAL DE ACTIVIDADES</h4>  
	                </div>
	                <div class="card-body">
						<div class="content table-responsive table-full-width">
                            <table class="table" style="font-size: 14px">
                                <tr align="center" style="font-weight: bold;">
                                    <td style="background-color: #9EA9AC;">UNIDAD / OFICINA</td>
                                    <td style="background-color: #B7E8F6;">PROC. ESTRATEGICOS</td>
                                    <td style="background-color: #8BB5DF">ACTIVIDADES</td>
                                    <td style="background-color: #5397DA">SUB ACTIVIDADES</td>
                                    <td style="background-color: #297BCC; color:white">ENTREGABLES</td>
                                    <td colspan="4" style="background-color: #1A2A8E; color:white">
                                        <tr>
                                            <td colspan="4">OBJETIVOS ESTRATÉGICOS</td>
                                        </tr>
                                        <tr>
                                            <td>OE1</td>
                                            <td>OE2</td>
                                            <td>OE3</td>
                                            <td>OE4</td>
                                        </tr>
                                    </td>
                                </tr>
                                <tr align="center">
                                    <td style="font-weight: bold; background-color: #9EA9AC">PLANEAMIENTO Y CALIDAD</td>
                                    <td style="background-color: #B7E8F6;">10</td>
                                    <td style="background-color: #8BB5DF">32</td>
                                    <td style="background-color: #5397DA">52</td>
                                    <td style="background-color: #297BCC; color:white">269</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                    <td style="background-color: #1A2A8E; color:white">9</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                    <td style="background-color: #1A2A8E; color:white">1</td>
                                </tr>
                                <tr align="center">
                                    <td style="font-weight: bold; background-color: #9EA9AC;">PLANIF, CALIDAD Y REC. MED</td>
                                    <td style="background-color: #B7E8F6;">3</td>
                                    <td style="background-color: #8BB5DF">16</td>
                                    <td style="background-color: #5397DA">33</td>
                                    <td style="background-color: #297BCC; color:white">74</td>
                                    <td style="background-color: #1A2A8E; color:white">1</td>
                                    <td style="background-color: #1A2A8E; color:white">2</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                    <td style="background-color: #1A2A8E; color:white">1</td>
                                </tr>
                                <tr align="center">
                                    <td style="font-weight: bold; background-color: #9EA9AC;">UNIDAD DE CAPACITACIÓN</td>
                                    <td style="background-color: #B7E8F6;">8</td>
                                    <td style="background-color: #8BB5DF">12</td>
                                    <td style="background-color: #5397DA">31</td>
                                    <td style="background-color: #297BCC; color:white">59</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                    <td style="background-color: #1A2A8E; color:white">8</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                </tr>
                                <tr align="center">
                                    <td style="font-weight: bold; background-color: #9EA9AC;">UNIDAD DE INTELIGENCIA SANITARIA</td>
                                    <td style="background-color: #B7E8F6;">2</td>
                                    <td style="background-color: #8BB5DF">5</td>
                                    <td style="background-color: #5397DA">34</td>
                                    <td style="background-color: #297BCC; color:white">290</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                    <td style="background-color: #1A2A8E; color:white">2</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                </tr>
                                <tr align="center" style="font-weight: bold;">
                                    <td style="background-color: #9EA9AC;">TOTAL</td>
                                    <td style="background-color: #B7E8F6;">23</td>
                                    <td style="background-color: #8BB5DF">65</td>
                                    <td style="background-color: #5397DA">150</td>
                                    <td style="background-color: #297BCC; color:white">692</td>
                                    <td style="background-color: #1A2A8E; color:white">1</td>
                                    <td style="background-color: #1A2A8E; color:white">21</td>
                                    <td style="background-color: #1A2A8E; color:white">0</td>
                                    <td style="background-color: #1A2A8E; color:white">2</td>
                                </tr>
                                <!-- <tr v-for="(e, index) in estado_cuenta" :key="index">
                                    <td>{{ e.periodo }}</td>
                                    <td>{{ e.formato }}</td>
                                    <td>{{ e.impuesto_predial }}</td>
                                    <td>{{ e.limpieza_publica }}</td>
                                    <td>{{ e.barrido_calles }}</td>
                                    <td>{{ e.parques_jardines }}</td>
                                    <td>{{ e.serenazgo }}</td>
                                    <td>{{ e.sub_total }}</td>
                                </tr>
                                <tr>
                                    <td colspan="7" class="text-right"><b>TOTAL</b></td>
                                    <td>{{ total }}</td>
                                </tr> -->
                            </table>
                        </div>
					</div>
	    		</div>
			 </div>
			</div>	
            <div class="row" id="oficina">
                <div class="col-md-12">
				<div class="card card-default">
	                <div class="card-header text-center" style="background-color: #2FA3C6; color: white;">
	                    <h4 class="title">Perfil</h4>  
	                </div>
	                <div class="card-body">
                        <h4 class="title">*Dé clic en enviar para generar una nueva contraseña</h4>
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-group">User</label>
                                <input type="text" readonly v-model="user.user" class="form-control" >
                            </div>
                            <div class="col-md-3">
                                <label class="form-group">Password</label>
                                <input type="password" v-model="user.pass" class="form-control" >
                            </div>
                        </div>
                        <br><br>
                        <div class="row">
                            <div class="col-md-3">
                                <input type="button" @click="actualizar()" value="Enviar" class="btn btn-outline-primary">
                            </div>
                        </div>
	                </div>
				</div>        
            </div>
            </div>
	    </div>
    </div>	
</template>

<script>
    export default {
    data() {
        return {
            user:{
                user:null,
                pass:null,
            },
			encargado:{
				nombre:null,
				oficina:null,
			},
            oficina: {
                nombre:null,
            },
			oficinasE:[{
				ID:null,
				oficina:null,
                encargado:null,
            }],
            columns: ["oficina","encargado","Acciones"],
            options: {
				headings:
				{
					oficina: "Oficina",
					encargado: "Encargado",
					Acciones: "Acciones",
					
				},
				sortable: ["Oficinas","Encargado"],
				filterable: ["Oficinas","Encargado"]
			},
			oficinas:[]

        }
	},
	created(){
		this.getDatos();
        this.getEncargados();
        
	},
	mounted(){
		$('#agregar').hide();
        $('#encargado').hide();
        $('#admin').hide();
        $('#oficina').hide();
        this.getTipo();
	},
    methods: {
		getDatos()
        {
            axios.get("getOficinas")
            .then(data=>
            {
                this.oficinas = data.data.oficinas;
                console.log(this.oficinas);
            }
            ).catch(error=>{
                console.log(error);
            })
		},
		getEncargados()
        {
            axios.get("getEncargados")
            .then(data=>
            {
                this.oficinasE = data.data.oficinas;
                console.log(this.oficinasE);
            }
            ).catch(error=>{
                console.log(error);
            })
        },
        getTipo()
        {
            axios.get("getTipo")
            .then(data=>
            {
                console.log(data.data);
                this.user.user = data.data.user;
                this.user.pass = data.data.pass;
                if(data.data.tipo == 1)
                {
                    $("#admin").show();
                    $("#oficina").hide();
                }else{
                    $("#admin").hide();
                    $("#oficina").show();
                }
            }
            ).catch(error=>{
                console.log(error);
            })
        },
        actualizar()
		{
			axios.post("updatePass",{
				user:this.user
			}).then(data=>{
				console.log(data);
				swal({
					type: 'success',
					title: 'Datos ingresados correctamente',
					showConfirmButton: false,
					timer: 2000
                });
                this.getTipo();
			}).catch(error=>{
				console.log(error);	
				swal({
					type: 'error',
					title: 'Error',
					text: 'Verifique los campos los campos obligatorios',
					showConfirmButton: true,
				});
			})
		},
		RegistrarEncargado()
		{
			axios.post("addEncargado",{
				encargado:this.encargado
			}).then(data=>{
				console.log(data);
				swal({
					position: 'top-end',
					type: 'success',
					title: 'Datos ingresados correctamente',
					showConfirmButton: false,
					timer: 2000
				});
				setTimeout(() => {
					location.reload();
				}, 1500);
			}).catch(error=>{
				console.log(error);	
				swal({
					type: 'error',
					title: 'Error',
					text: 'Verifique los campos los campos obligatorios',
					showConfirmButton: true,
				});
			})
		},
		ocultar(id){
			if(id == '1')
			{
				$('#agregar').show();
			}
			else if(id == '2')
			{
				$('#encargado').show();	
			}
			else if(id == '3')
			{
				$('#agregar').hide();	
			}
			else if(id == '4')
			{
				$('#encargado').hide();	
			}
		},
		deleteEncargado(id){
            swal({
                title: '¿Deseas eliminar este Encargado?',
                text: "No será posible revertir esta acción!",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, elíminalo!',
                cancelButtonText: 'No, cancelar!',
            }).then((result) => {
                if (result.value) {
                    axios.get(`/eliminarEncargado/${id}`)
                        .then(data => {
                        if(data.data=="OK"){
                            swal(
                            'Eliminado!',
                             'El Encargado ha sido eliminado.',
                             'success'
                                );
                            setTimeout(() => {
                                location.reload();
                                this.getData();
                            }, 1500);
                        }
                        }).catch(error => {
                            console.log('Ocurrio un error ' + error);
                            this.$Progress.fail();
                        });
                     }
                });
        },
    }
}
</script>
